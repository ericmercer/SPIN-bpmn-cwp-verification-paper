The model of the workflow and CWP object state require behaviors defined for all input. For example, the CWP object state is transformed over time by various distributed activities carried out by different actors. Some aspects of the object state are transformed directly by the system workflow, such as the doctor orders, while others are inputs on which a workflow makes decisions, such as the patient severity and trending patient severity. These later inputs form the \emph{environment} in which the CWP exists. For verification, the behavior of these environment inputs must be modeled, and the verification results only hold relative to the behaviors considered by that environment model. The same is true for aspects of the workflow. Each is discussed below.

\subsection{CWP Environment Model}
In this model, the \texttt{sevLvl} and \texttt{trndSevLvl} in the CWP object state are part of the environment, and as such, are inputs on which any workflow makes decisions. For example, the severity of the patient is established by an exam with a physician, but that severity is fundamentally a characteristic of the patient and the progression of the disease. The physician assesses the patient and ascribes a severity, but the patient, with their symptoms, are an input to the model. The same with the trending severity. The \texttt{careCapLvl} is fixed and does not change so it does no need to be modeled. These data are what the workflow uses for decisions regarding patient risk and appropriate intervention. 

There is, of course, a causal relationship between the decisions in a workflow and the resulting subsequent input. For example, it is normally expected that when a doctor orders a patient admitted to the hospital that at some point in the future the severity rating for the patient diminishes due to the increased level of intervention and care. Here is where modeling choices can limit the impact, and meaning, of any verification results as the verification only hold for the modeled input behavior.

This model of the CWP for remote patient care creates the weakest, that is to say, the least restrictive, environment model possible in which a workflow is able to be verified. That means the environment model includes behavior that exists in the real world (i.e., the causal relationships), and it includes behaviors that do not exist in the real world. The goal is to create a \emph{sound over-approximation} of feasible environment behavior meaning that it includes the real world behavior plus other behavior that is not possible in the real world. If a workflow verifies in the sound over-approximated environment, then by implication, that verification result holds in the real world since those behaviors are a subset of the ones considered for verification. 

The model for the \texttt{sevLvl} strongly correlates with \texttt{trndSevLvl}.
%
{\small
\begin{lstlisting}[style=myPromela]
inline updatePatientSeverity(trndSevLvl, sevLvl) {
  if
  :: (isINIT(sevLvl) && isINIT(trndSevLvl)) -> 
      if
      :: true -> setSeverity(sevLvl, 0)
      :: true -> setSeverity(sevLvl, 1)
      :: true -> setSeverity(sevLvl, 2)
      fi 
  :: isWithinCareCapability(trndSevLvl) -> 
      if
      :: true -> setSeverity(sevLvl, 0)
      :: true -> setSeverity(sevLvl, 1)
      fi
  :: else -> 
      if
      :: true -> setSeverity(sevLvl, 1)
      :: true -> setSeverity(sevLvl, 2)
      fi
  fi
  setSeverity(trndSevLvl, sevLvl)
  logSeverity(sevLvl)
}
\end{lstlisting}
}
%
\noindent Promela semantics are non-deterministic, meaning that the model produces different outcomes from run to run. The model defines where that non-determinism takes place with choices to consider. Model checking considers all the ways possible to resolve the non-determinism to construct an exhaustive proof that a property holds in the model. 

The if-statement is one way to specify a point of non-determinism. In the model for \texttt{sevLvl}, in any one of the second level if-statements, the \texttt{:: true ->}, is an always enabled choice for the if-statement to resolve. 

For example, for the first exam where \texttt{sevLvl} and \texttt{trndSevLvl} have initial values, the resulting severity can by any one of the three choices: 0, 1, or 2. The other choices are determined by the \texttt{trndSevLvl} value with there being two choices when \texttt{trndSevLvl} is within the care capability of the patient and two choices otherwise.

The final note is that the model synchronizes the value of \texttt{trndSevLvl} after choosing a value for \texttt{sevLvl}. The reasoning is that \texttt{sevLvl} should only be updated at the time of an actual exam. As such, \texttt{trndSevLvl} should reflect the outcome of that exam since the two values are strongly correlated.

Of note is that the model may never assign \texttt{sevLvl} to zero! It is possible for the model checker to resolve the non-determinism in such a way that \texttt{sevLvl} is always one. The result is that the patient may never be discharged and may never expire at the same time. Such behavior exists in the model but is not consistent with the real world. These are part of the sound over-approximation, and when necessary, are constrained out by changing the model or constraining what behaviors are considered in the model with a fairness property as discussed previously.

The model for \texttt{trndSevLvl} is simple with only two non-deterministic choices that are independent of the actual \texttt{sevLvl} of the patient. 
%
{\small
\begin{lstlisting}[style=myPromela]
inline updateSeverityTrend(trndSevLvl) {
  if
  :: true -> 
    setWithinCareCapability(trndSevLvl)
  :: true -> 
    setOutsideCareCapability(trndSevLvl)
  fi

  logTrend(trndSevLvl)
}
\end{lstlisting}
}
%
\noindent The amount that a patient is within or without the bounds of their care capability is not considered in this model; rather, \texttt{trndSevLvl} is reduced to a Boolean proposition indicating if the case is one way or the other.

There is one final model that is part of the environment associated with the CWP, and that is the model for patient mortality. 
%
{\small
\begin{lstlisting}[style=myPromela]
inline updatePatientMortality(trndSevLvl, 
  sevLvl) {
  if
  :: !isWithinCareCapability(trndSevLvl) -> 
    setSeverity(sevLvl, EXPIRED)
  :: !isWithinCareCapability(sevLvl) ->
    setSeverity(sevLvl, EXPIRED)
  :: true
  fi
  logSeverity(sevLvl)
}
\end{lstlisting}
}
%
\noindent A patient may expire anytime the \texttt{sevLvl} or \texttt{trndSevLvl} is outside the bounds of the care capability.

\subsection{Workflow Environment Model}

 The workflow itself has state not just for where the tokens are located as discussed is \secref{sec:bpmn}. It makes decisions at different points based on the values of \texttt{alert}, \texttt{examType}, and \texttt{examTime}. Their values are updated by their associated tasks in the workflow, but how the values evolve over time is not specified. As such, they are modeled as inputs provided by the environment which are sampled when their associated tasks are activated.

The \texttt{alert} is only correlated with \texttt{trndSevLvl} in that it is updated whenever the trend is updated, but aside from that, it is unconstrained; thus, it is able to be raised or not raised each time regardless of the value of \texttt{trndSevLvl}. The \texttt{examType} is correlated with \texttt{trndSevLvl} in that it can become urgent if the trend is outside the care capability level. The \texttt{examTime} is non-deterministic once it is scheduled meaning it randomly choses between leaving it scheduled and having the exam be now.

This non-determinism in \texttt{examTime} means that one behavior in the workflow model is that \texttt{examTime} is never \texttt{now} and is infinitely just \texttt{scheduled}. Such behavior is one of several behaviors that are part of the workflow model but not consistent with the real world in which the workflow exists. As before, this behavior is constrained by the fairness property as discussed previously.
